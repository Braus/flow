<link rel="import" href="_servlet_context_/frontend/bower_components/polymer/polymer-element.html">
<link rel="import" href="web-component-ui.html">

<dom-module id="_TagDash_">
  <template>

    <style>
      :host {
        display: inline-block;
      }
    </style>
    <slot></slot>
  </template>
  <script>
    class _TagCamel_ extends Polymer.Element {
      static get is() {
        return '_TagDash_';
      }

      static get properties() {
        return _Properties_

      }

      _PropertyMethods_

      _sync(property, newValue) {
        if (this.$server) {
          this.$server.sync(property, newValue);
        }
      }

      connectedCallback() {
        super.connectedCallback();
        
        self = this;
        
        document.body.addEventListener('root-element', function(event) {
            var rootId = event.detail;
            var flowRoot;
            if ( !rootId || rootId ==''){
                flowRoot = document.body;
            }
            else {
                flowRoot = document.getElementById(rootId);
            }
            if (!self.$.id) {
                self._registerElement(flowRoot);
              } else if (flowRoot && flowRoot.$server) {
                  self.$server.reconnect();
              }

              console.log('connected', this);
        });
        
      }
      
      _registerElement(flowRoot) {
        this.$.id = "_TagCamel_-" + _TagCamel_.id++;

        // Needed to make Flow do lookup correctly
        const poller = () => {
          if (flowRoot && flowRoot.$server) {
            flowRoot.$ = flowRoot.$ || {};
            flowRoot.$[this.$.id] = this;
            flowRoot.$server.connectWebComponent('_TagDash_', this.$.id);
          } else {
            setTimeout(poller, 10);
          }
        };

        poller();
      }

      disconnectedCallback() {
        this.$server.disconnected();

        console.log('disconnected', this);
      }

      serverConnected() {
        Object.keys(_TagCamel_.properties).forEach(prop => {
          this._sync(prop, this[prop]);
        });
      }
    }

    _TagCamel_.id = 0;

    customElements.define(_TagCamel_.is, _TagCamel_);
  </script>
</dom-module>
